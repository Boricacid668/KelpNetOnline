branches:
  only:
    - master

skip_tags: true

image: Visual Studio 2017

configuration: Release

before_build:
    - nuget restore KelpNet.sln

build: 
  parallel: true
  project: KelpNet.sln
  verbosity: normal

before_test:
    - IF NOT EXIST "C:\Intel\OpenCL\" ( appveyor DownloadFile "http://registrationcenter-download.intel.com/akdlm/irc_nas/vcp/12527/intel_sdk_for_opencl_2017_7.0.0.2567.exe" )
    - IF NOT EXIST "C:\Intel\OpenCL\" ( start /wait .\intel_sdk_for_opencl_2017_7.0.0.2567.exe install --output=output.log --eula=accept )
    - IF NOT EXIST "C:\Program Files (x86)\Common Files\Intel\OpenCL\" ( appveyor DownloadFile "http://registrationcenter-download.intel.com/akdlm/irc_nas/12512/opencl_runtime_16.1.2_x64_setup.msi" )
    - IF NOT EXIST "C:\Program Files (x86)\Common Files\Intel\OpenCL\" ( start /wait msiexec /i opencl_runtime_16.1.2_x64_setup.msi /qn  /l*v clruntime.log ) )
    - "SET PATH=C:\\Python37-x64;C:\\Python37-x64\\Scripts;%PATH%"
    - pip install chainer

test_script:
    - .\packages\OpenCover.4.7.922\tools\OpenCover.Console.exe -filter:"+[KelpNet*]* -[KelpNet.Tests*]*" -register:user -target:"C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\Common7\IDE\CommonExtensions\Microsoft\TestWindow\vstest.console.exe" -targetargs:"KelpNet.Tests.dll /platform:x64" -targetdir:".\KelpNet.Tests\bin\Release" -excludebyattribute:*.ExcludeFromCodeCoverage* -hideskipped:All -output:Cover_result.xml
    
after_test:
    - pip install codecov
    - codecov -f "Cover_result.xml"
